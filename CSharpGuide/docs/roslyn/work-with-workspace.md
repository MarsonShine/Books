# 使用工作空间

工作空间层是对整个解决方案进行代码分析和重构的起点。在此层中，Workspace API 可帮助您将解决方案中有关项目的所有信息组织到单个对象模型中，使您可以直接访问编译器层对象模型，如源文本、语法树、语义模型和编译，而无需解析文件、配置选项或管理项目间的依赖关系。

宿主环境，如 IDE，为您提供与开放解决方案相对应的工作空间。也可以通过简单地加载解决方案文件在 IDE 之外使用此模型。

## 工作区

工作区（workspace）是作为项目集合的解决方案的活动表示，每个项目都有一个文档集合。工作区通常与主机环境相关联，主机环境会随着用户键入或操作属性而不断变化。

[工作区](https://learn.microsoft.com/en-us/dotnet/api/microsoft.codeanalysis.workspace)提供对解决方案当前模型的访问。当主机环境发生变化时，工作区会触发相应的事件，并更新 [Workspace.CurrentSolution](https://learn.microsoft.com/en-us/dotnet/api/microsoft.codeanalysis.workspace.currentsolution#microsoft-codeanalysis-workspace-currentsolution) 属性。例如，当用户在与其中一个源文档相对应的文本编辑器中键入时，工作区会使用一个事件来表示解决方案的整体模型已更改以及修改了哪个文档。然后，您可以通过分析新模型的正确性、突出重要区域或提出代码更改建议来对这些更改做出反应。

您还可以创建与宿主环境断开连接或在没有宿主环境的应用程序中使用的独立工作区。

## 解决方案、项目和文档

尽管每次按下某个键时工作区可能会发生变化，但您可以单独使用解决方案的模型。

解决方案是项目和文档的不可变模型。这意味着无需锁定或复制即可共享模型。从 Workspace.CurrentSolution 属性获取解决方案实例后，该实例将永远不会更改。但是，与语法树和编译一样，您可以通过基于现有解决方案和特定更改构建新实例来修改解决方案。要使工作区反映您的更改，您必须明确地将更改的解决方案应用回工作区。

项目是整体不可变解决方案模型的一部分。它代表所有源代码文档、解析和编译选项，以及程序集和项目到项目的引用。从项目中，您可以访问相应的编译，而无需确定项目依赖项或解析任何源文件。

文档也是整体不可变解决方案模型的一部分。文档表示单个源文件，您可以从中访问文件的文本、语法树和语义模型。

下图展示了工作区如何与主机环境、工具以及如何进行编辑相关联。

![](../asserts/workspace-obj-relations.png)

## 概括

Roslyn 公开了一组编译器 API 和工作区 API，它们提供了有关源代码的丰富信息，并且与 C# 和 Visual Basic 语言完全一致。 .NET Compiler Platform SDK 显着降低了创建以代码为中心的工具和应用程序的进入门槛。它为元编程、代码生成和转换、C# 和 Visual Basic 语言的交互使用以及在特定领域语言中嵌入 C# 和 Visual Basic 等领域创造了许多创新机会。
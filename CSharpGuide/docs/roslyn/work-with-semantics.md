# 使用语义

语法树表示源代码的词汇和句法结构。尽管仅此信息就足以描述源代码中的所有声明和逻辑，但不足以识别所引用的内容。一个名字可能代表：

- 类型
- 字段
- 方法
- 局部变量

尽管其中每一个都是独一无二的，但要确定一个标识符实际指代的是哪一个，通常需要对语言规则有深刻的理解。

有源代码中表示的程序元素，程序也可以引用以前编译的库，打包在汇编文件中。尽管程序集没有源代码，因此也没有语法节点或树，但程序仍然可以引用其中的元素。

对于这些任务，您需要**语义模型（Semantic Model）**。

除了源代码的句法模型之外，语义模型还封装了语言规则，为您提供了一种将标识符与所引用的正确程序元素正确匹配的简便方法。

## 编译

编译（compilation）是编译 C# 或 Visual Basic 程序所需的一切的表示，其中包括所有程序集引用、编译器选项和源文件。

因为所有这些信息都集中在一个地方，所以可以更详细地描述源代码中包含的元素。编译将每个声明的类型、成员或变量表示为一个符号。编译包含多种方法，可帮助您查找和关联已在源代码中声明或作为元数据从程序集中导入的符号。

与语法树类似，编译是不可变的。创建编译后，您或您可能与之共享的任何其他人都无法更改它。但是，您可以从现有编译创建新编译，并在执行此操作时指定更改。例如，您可能会创建一个与现有编译在各方面都相同的编译，只是它可能包含一个额外的源文件或程序集引用。

## 符号

符号（symbol）表示由源代码声明或作为元数据从程序集中导入的不同元素。每个**命名空间**、**类型**、**方法**、**属性**、**字段**、**事件**、**参数**或**局部变量**都由一个符号表示。

[Compilation](https://learn.microsoft.com/en-us/dotnet/api/microsoft.codeanalysis.compilation) 类型的各种方法和属性可帮助您查找符号。例如，您可以通过通用元数据名称找到已声明类型的符号。您还可以将整个符号表作为以全局名称空间为根的符号树进行访问。

符号还包含编译器从源或元数据确定的附加信息，例如其他引用的符号。每种符号都由一个从 [ISymbol](https://learn.microsoft.com/en-us/dotnet/api/microsoft.codeanalysis.isymbol) 派生的单独接口表示，每个接口都有自己的方法和属性，详细说明了编译器收集的信息。其中许多属性直接引用其他符号。例如，[IMethodSymbol.ReturnType](https://learn.microsoft.com/en-us/dotnet/api/microsoft.codeanalysis.imethodsymbol.returntype#microsoft-codeanalysis-imethodsymbol-returntype) 属性告诉您该方法返回的实际类型符号。

**符号表示源代码和元数据之间的名称空间、类型和成员的通用表示。**例如，在源代码中声明的方法和从元数据导入的方法都由具有相同属性的 [IMethodSymbol](https://learn.microsoft.com/en-us/dotnet/api/microsoft.codeanalysis.imethodsymbol) 表示。

符号在概念上类似于由 System.Reflection API 表示的 CLR 类型系统，但它们更丰富，因为它们建模的不仅仅是类型。命名空间、局部变量和标签都是符号。此外，符号是语言概念的表示，而不是 CLR 概念。有很多重叠，但也有许多有意义的区别。例如，C# 或 Visual Basic 中的迭代器方法是单个符号。但是，当迭代器方法被翻译成 CLR 元数据时，它是一个类型和多个方法。

## 语义模型

语义模型表示单个源文件的所有语义信息。您可以使用它来发现以下内容：

- 在源中特定位置引用的符号。
- 任何表达式的结果类型。
- 所有诊断，即错误和警告。
- 变量如何流入和流出源区域。
- 更多推测性问题的答案。

下一篇：[使用工作空间](work-with-workspace.md)
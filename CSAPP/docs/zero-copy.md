# 零拷贝技术

零拷贝（zero-copy）技术是指在数据传输时，**避免了数据在内核空间和用户空间之间的复制操作，从而提高了数据传输的效率。其主要原理是通过在操作系统内核中实现 DMA（Direct Memory  Access）机制，使得数据可以直接从磁盘、网络等设备读取到内存中，然后直接发送到目标内存中，避免了多次数据拷贝的过程。**

当一个应用程序需要从网络或磁盘读取数据时，一般的传输过程是先将数据从设备中读取到内核缓冲区，然后再将数据从内核缓冲区拷贝到用户空间缓冲区，最后再将数据发送到目标内存中。而零拷贝技术则可以直接从设备读取数据，经过 DMA 等机制将数据直接传输到目标内存中，避免了在内核空间和用户空间之间的多次数据拷贝，从而提高了数据传输的效率。

> 一般数据传输过程：disk -> os cache(内核态) -> 应用端（用户态缓冲区）-> 目标输出
>
> 零拷贝：disk -> DMA -> 目标输出

需要注意的是，零拷贝技术并不是在所有情况下都适用的，因为在某些场景下，数据的处理必须要在内核空间和用户空间之间进行来回传输，这时候就不能使用零拷贝技术了。

> 在 linux，网络程序可以通过 `sendfile()` 和 `splice()` 系统调用实现零拷贝。存储系统和数据库则可以通过 `mmap()` 或`直接I/O`系统调用实现零拷贝
>
> 在 windows 也有类似的技术：
>
> 1. 文件映射（File Mapping）：文件直接映射到应用程序的内存空间，避免了数据复制的过程。
> 2. 网络传输：使用 `WSASend()`和 `WSARecv()` 等系统调用来直接传输数据，避免了数据复制的过程。
> 3. DMA 技术：DMA技术可以实现数据在系统总线和内存之间的直接传输，避免了CPU和内存资源的浪费。
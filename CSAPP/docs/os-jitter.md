# 操作系统抖动

操作系统抖动（OS Jitter），或简称为抖动，是指在计算系统中，任务或程序执行时间的不一致性或波动。这种波动可能是由于硬件、操作系统调度、或其他软件干扰引起的。在实时系统或高性能计算环境中，抖动尤其受到关注，因为它可能导致性能下降，使系统无法达到预期的响应时间或处理速率。

首先我们从底层操作系统内核和硬件层面来说明操作系统抖动（OS Jitter）是如何产生的

1. **中断**：包括硬件和软件中断，它们会导致正在执行的任务被暂停，CPU转而处理中断。
2. **内核线程和守护线程**：这些通常在后台运行，处理如日志、内存管理等系统任务，可能占用CPU资源。例如 RCU 优雅周期内核线程（rcu_bh、rcu_preempt 及 rcu_sched），可以通过使用 `taskset` 命令、`sched_setaffinity()`系统调用或者 `cgroups`，来将其强制绑定到任意目标 CPU。
3. **调度器**：调度器的决策和任务切换本身会引入抖动，特别是在任务优先级和时间片分配上。
4. **定时器和设备驱动**：定时器回调和设备驱动程序的执行可能会打断或延迟正常任务的执行。
5. **内核全系统同步算法**：例如使用全局锁或其他广泛影响的同步机制，可能引起显著的延迟。
6. **调度时钟中断及RCU回调**：这些定期事件的处理可能打断正在进行的任务。
7. **页面异常**：内存访问错误引起的页面异常处理可能导致 CPU 资源的显著消耗。
8. **硬件和固件**：底层的硬件行为和固件操作也可能引入不预期的延迟。

为了减少系统抖动对性能的影响，可以采取以下一些策略：

- **优化锁和资源竞争**：改进锁的使用策略，使用更细粒度的锁或无锁编程技术。
- **调整任务优先级和调度策略**：确保高优先级任务获得足够的CPU时间，减少不必要的任务切换。
- **内存管理优化**：增加物理内存，优化内存分配策略，减少分页和交换。
- **实时操作系统（RTOS）**：对于需要严格时间控制的应用，使用实时操作系统可以提供更可预测的任务调度。
- **硬件和软件隔离**：在关键任务和非关键任务之间进行硬件和软件隔离，例如使用专用的处理器核心。